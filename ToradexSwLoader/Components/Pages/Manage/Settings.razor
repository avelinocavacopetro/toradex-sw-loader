@page "/manageSecret"

@inject IJSRuntime JS
@inject TorizonService TorizonService
@inject SweetAlertService Swal
@inject FilterService FilterService

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<PageTitle>Definições</PageTitle>

<div class="custom-container">
    <div class="page-title">
        <i class="bi bi-card-list fs-3" style="padding-left: 10px;"></i>
        <h3 class="pt-2">Definições</h3>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-4">
        <div class="row mb-3">
            <div class="col-auto">
                <label for="refreshTime" class="fw-bold fs-5">
                    Tempo de atualização de dados (máx. 60 seg.)
                </label>
                <input id="refreshTime" @bind="refreshTime" type="number" min="10" max="60" class="form-control mt-2" />
            </div>
        </div>
        
        <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-color btn-lg"
                    style="font-size: 1.25rem;"
                    @onclick="ConfirmAndSubmit">
                <i class="bi bi-floppy"></i> Aplicar
            </button>
        </div>
    </div>
</div>

@code {
    private int refreshTime = 10;

    protected override async Task OnInitializedAsync()
    {
        await FilterService.LoadFilterAsync();

        refreshTime = FilterService.RefreshTime;
    }

    private async Task ConfirmAndSubmit()
    {
        if (refreshTime < 10 || refreshTime > 60)
        {
            await Swal.FireAsync(new SweetAlertOptions
            {
                Title = "Por favor coloque um valor entre 10 a 60 segundos!",
                Icon = SweetAlertIcon.Warning,
                ConfirmButtonColor = "#0B5120"
            });
            return;
        }

        await FilterService.ApplyTimeFilter(refreshTime);

        await Swal.FireAsync(new SweetAlertOptions
        {
            Title = "Filtros aplicados com sucesso!",
            Icon = SweetAlertIcon.Success,
            ConfirmButtonColor = "#0B5120"
        });
    }
}
